<div>
  <tabset justified="true">
    <!-- Stage 1: Define 1 survey item with n sessions in survey -->
    <!-- (study, survey, completedBy) -->
    <!-- (surveyVersion, name, timepoint, availableFrom, availableTo, type) -->
    <tab heading="Define Survey" active="surveyBuilder.STAGES['DEFINE_SURVEY']">
      <ng-form name="surveyBuilder.surveyForm" class="form-horizontal" novalidate>
        <div class="form-group">
          <label for="name" class="col-sm-3 control-label">Survey Name&nbsp;</label>

          <div class="col-sm-9">
            <input type="text" name="name" class="form-control"
                   data-ng-model="surveyBuilder.survey.name" required>

            <p ng-show="surveyBuilder.surveyForm.name.$invalid && !surveyBuilder.surveyForm.name.$pristine"
               class="pull-right required-error">Survey must have a name.</p>
          </div>
        </div>
        <div class="form-group">
          <label for="completedBy" class="col-sm-3 control-label">Completed By&nbsp;</label>

          <div class="col-sm-9">
            <select name="completedBy" class="form-control" ng-model="surveyBuilder.survey.completedBy" required>
              <option value="" disabled>Select the type of user</option>
              <option value="subject" label="Subject">Subject</option>
              <option value="coordinator" label="Coordinator">Coordinator</option>
            </select>

            <p
              ng-show="surveyBuilder.surveyForm.completedBy.$invalid && !surveyBuilder.surveyForm.completedBy.$pristine"
              class="pull-right required-error">You must select a type of user to complete the survey.</p>
          </div>
        </div>
      </ng-form>

      <hr/>
      <session-builder session="surveyBuilder.newSession"
                       generate-sessions="surveyBuilder.generateSessions"></session-builder>
      <hr/>

      <list-editor list="surveyBuilder.survey.sessions"
                   columns="surveyBuilder.sessionColumns"
                   affix-missing="false"
                   can-edit="true"
                   can-add-newcol="false"
                   can-add-newrow="false"
                   can-edit-header="false"
                   can-del-row="false"
                   can-del-col="false"
                   force-reload="surveyBuilder.toggleReload">
      </list-editor>
    </tab>

    <!-- Stage 2: Configure m formVersions for each n session in survey -->
    <!-- (list of formVersions applied to sessions) -->
    <tab heading="Select Forms" active="surveyBuilder.STAGES['SELECT_FORMS']">
      <div class="input-group">
        <input id="hideLimit" class="form-control" ng-model="surveyBuilder.timelineQuery"
               placeholder="Filter sessions"/>
        <span class="input-group-addon">
          <i class="fa fa-search"></i>
        </span>
      </div>
      <br/>

      <div class="timeline-container" scroll-watch onscrolldown="surveyBuilder.loadNext()"
           onscrollup="surveyBuilder.loadPrev()" onscrolltop="surveyBuilder.hideLimit = 0">
        <timeline>
          <timeline-event
            ng-repeat="session in surveyBuilder.survey.sessions | filter:surveyBuilder.timelineQuery | limitTo:surveyBuilder.showLimit:surveyBuilder.hideLimit">
            <timeline-badge class="info">
              <i class="glyphicon glyphicon-calendar"></i>
            </timeline-badge>
            <timeline-panel class="info">
              <timeline-heading>
                <h4>{{session.name}}</h4>
              </timeline-heading>
              <ul class="list-unstyled" ui-sortable="{ 'ui-floating': true, 'cursor': 'move' }"
                  ng-model="session.formOrder">
                <li ng-repeat="id in session.formOrder"
                    class="selectable"
                    ng-style="{ 'margin-bottom': '-5px' }"
                    ng-switch="surveyBuilder.isFormActive(id, session)">
                  <h4>
                    <span ng-switch-when="true" class="label label-primary"
                          ng-click="surveyBuilder.addRemoveForm(id, session)">
                      {{$index + 1}}) {{surveyBuilder.formVersions[id].name}}
                      <i class="fa fa-times"></i>
                    </span>
                    <span ng-switch-default class="label label-default"
                          ng-click="surveyBuilder.addRemoveForm(id, session)">
                      <s>{{$index + 1}}) {{surveyBuilder.formVersions[id].name}}</s>
                      <i class="fa fa-plus"></i>
                    </span>
                  </h4>
                </li>
              </ul>
            </timeline-panel>
          </timeline-event>
        </timeline>
      </div>
    </tab>
  </tabset>
</div>
